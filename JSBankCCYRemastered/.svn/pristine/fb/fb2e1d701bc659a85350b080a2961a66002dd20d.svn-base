//
//  CCYWebAlertView.m
//  JSBankCCY
//
//  Created by 黄徐根 on 17/3/16.
//  Copyright © 2017年 张瑞. All rights reserved.
//

#import "CCYAlertView.h"
#import "Masonry.h"
@interface CCYAlertView()

@property(nonatomic,strong)UIView  *mainView;

@property(nonatomic,strong)UIView *titleView;

@property(nonatomic,strong)UIView *detailView;

@property(nonatomic,strong)UIView *operationView;

@property(nonatomic,strong)UILabel *titleLabel;

@property(nonatomic,strong)UILabel *detailLabel;

@property(nonatomic,strong)UIButton *doneBtn;

@property(nonatomic,strong)UIButton *cancelBtn;

@property(nonatomic,strong)UIView   *lineHTitle;

@property(nonatomic,strong)UIView   *lineHDetail;

@property(nonatomic,strong)UIView   *lineVBtn;

@property(nonatomic,assign)CGFloat buttonWidth;

@property(nonatomic,copy)NSString *title;

@property(nonatomic,copy)NSString *detailMessage;

@property(nonatomic,copy)NSString *cancelTitle;

@property(nonatomic,copy)NSString *doneTitle;

@property(nonatomic,assign)NSInteger mainViewHeight;

@property(nonatomic,assign)CGSize imageSize;

@property(nonatomic,copy)void(^DoneClickHandle)(CCYAlertView *alertView);

@property(nonatomic,copy)void(^CancelClickHandle)(CCYAlertView *alertView);


@end


@implementation CCYAlertView

-(instancetype)initAlertViewWithTitle:(NSString *)title message:(NSString *)message doneTitle:(NSString *)doneTitle cancelTitle:(NSString *)cancelTitle delegate:(id)objcect
{
    if (self=[super init])
    {
       
        self.tag=123456789;
        self.delegate=objcect;
        self.title=title;
        self.detailMessage=message;
        self.cancelTitle=cancelTitle;
        self.doneTitle=doneTitle;
        [self initAlertView];
        
    }
    return self;
}

-(instancetype)initAlertViewWithTitle:(NSString *)title message:(NSString *)message doneTitle:(NSString *)doneTitle cancelTitle:(NSString *)cancelTitle doneClickHandle:(void (^)(CCYAlertView *alertView))doneHandle cancelClickHandle:(void (^)(CCYAlertView *alertView))cancelHandle
{
    if (self=[super init])
    {
        self.tag=123456789;
        self.title=title;
        self.detailMessage=message;
        self.cancelTitle=cancelTitle;
        self.doneTitle=doneTitle;
        self.DoneClickHandle=doneHandle;
        self.CancelClickHandle=cancelHandle;
        [self initAlertView];
    }
    return self;

}

-(void)initAlertView
{
    self.frame=[UIScreen mainScreen].bounds;
    self.backgroundColor=[[UIColor blackColor] colorWithAlphaComponent:0.6];//PNCColorRGBA(100, 100, 100, 0.7);
    self.mainView=[[UIView alloc]initWithFrame:CGRectZero];
    self.mainView.center=self.center;
    self.mainView.layer.cornerRadius=10.0f;
    self.mainView.clipsToBounds=YES;
    self.mainView.layer.borderColor=[PNCColorRGBA(238, 238, 238, 1) CGColor];
    self.mainView.layer.borderWidth=0.5;
    self.mainView.backgroundColor=[UIColor colorWithRed:246 green:246 blue:246 alpha:1];
    
    self.titleView=[[UIView alloc]initWithFrame:CGRectZero];
    self.titleView.clipsToBounds=YES;
//    self.titleView.backgroundColor=[UIColor whiteColor];
    
    
    self.titleLabel=[[UILabel alloc]initWithFrame:CGRectZero];
//    self.titleLabel.backgroundColor=[UIColor whiteColor];
    self.titleLabel.textColor=PNCColorRGBA(177, 177, 177, 1);
    self.titleLabel.text=self.title;
    self.titleLabel.clipsToBounds=YES;
    self.titleLabel.textAlignment=NSTextAlignmentCenter;
    self.titleLabel.font=UIFont(20.0f);

    self.lineHTitle=[[UIView alloc]initWithFrame:CGRectZero];
    self.lineHTitle.backgroundColor=PNCColorRGBA(238, 238, 238, 1);
    
    self.detailView=[[UIView alloc]initWithFrame:CGRectZero];
    self.detailView.clipsToBounds=YES;
    
    self.detailLabel=[[UILabel alloc]initWithFrame:CGRectZero];
    self.detailLabel.text=self.detailMessage;
    self.detailLabel.textColor=PNCColorRGBA(51, 51, 51, 1);
    self.detailLabel.numberOfLines=0;
    self.detailLabel.font=UIFont(16.0f);
    self.detailLabel.clipsToBounds=YES;
    self.detailLabel.textAlignment=NSTextAlignmentCenter;
   
    
    self.mainView.translatesAutoresizingMaskIntoConstraints=NO;
    self.titleView.translatesAutoresizingMaskIntoConstraints=NO;
    self.titleLabel.translatesAutoresizingMaskIntoConstraints=NO;
    self.lineHTitle.translatesAutoresizingMaskIntoConstraints=NO;
    self.detailView.translatesAutoresizingMaskIntoConstraints=NO;
    self.detailLabel.translatesAutoresizingMaskIntoConstraints=NO;
    
    [self addSubview:self.mainView];
    [self.mainView addSubview:self.titleView];
    [self.titleView addSubview:self.titleLabel];
    [self.mainView addSubview:self.lineHTitle];
    [self.mainView addSubview:self.detailView];
    [self.detailView addSubview:self.detailLabel];

    self.lineHDetail=[[UIView alloc]initWithFrame:CGRectZero];
    self.lineHDetail.backgroundColor=PNCColorRGBA(238, 238, 238, 1);
    
    self.operationView=[[UIView alloc]initWithFrame:CGRectZero];
    self.operationView.clipsToBounds=YES;
//    self.operationView.backgroundColor=[UIColor whiteColor];
    
    
    self.lineVBtn=[[UIView alloc]init];
    self.lineVBtn=[[UIView alloc]initWithFrame:CGRectZero];
    self.lineVBtn.backgroundColor=PNCColorRGBA(238, 238, 238, 1);
    
    self.cancelBtn=[UIButton buttonWithType:UIButtonTypeCustom];
    self.cancelBtn=[[UIButton alloc]initWithFrame:CGRectZero];
    self.cancelBtn.titleLabel.font=UIFont(18.0f);
    self.cancelBtn.clipsToBounds=YES;
    
//    self.cancelBtn.backgroundColor=[UIColor whiteColor];
    [self.cancelBtn setTitleColor:PNCColorRGBA(51, 51, 51, 1) forState:UIControlStateNormal];
    [self.cancelBtn setTitleColor:PNCColorRGBA(153, 153, 153, 1) forState:UIControlStateHighlighted];
    [self.cancelBtn setTitle:self.cancelTitle forState:UIControlStateNormal];
    [self.cancelBtn addTarget:self action:@selector(cancelBtnClick) forControlEvents:UIControlEventTouchUpInside];
    self.cancelBtn.titleLabel.textAlignment=NSTextAlignmentCenter;
    
    self.doneBtn=[UIButton buttonWithType:UIButtonTypeCustom];
    self.doneBtn=[[UIButton alloc]initWithFrame:CGRectZero];
    self.doneBtn.titleLabel.font=UIFont(18.0f);
    self.doneBtn.clipsToBounds=YES;
    [self.doneBtn setTitleColor:PNCColorRGBA(74, 139, 234, 1) forState:UIControlStateNormal];
    [self.doneBtn setTitle:self.doneTitle forState:UIControlStateNormal];
    
    [self.doneBtn addTarget:self action:@selector(doneBtnClick) forControlEvents:UIControlEventTouchUpInside];
    self.doneBtn.titleLabel.textAlignment=NSTextAlignmentCenter;
    
    self.lineHDetail.translatesAutoresizingMaskIntoConstraints=NO;
    self.operationView.translatesAutoresizingMaskIntoConstraints=NO;
    self.lineVBtn.translatesAutoresizingMaskIntoConstraints=NO;
    self.cancelBtn.translatesAutoresizingMaskIntoConstraints=NO;
    self.doneBtn.translatesAutoresizingMaskIntoConstraints=NO;
    
    [self.mainView addSubview:self.lineHDetail];
    [self.mainView addSubview:self.operationView];
    [self.operationView addSubview:self.lineVBtn];
    [self.operationView addSubview:self.cancelBtn];
    [self.operationView addSubview:self.doneBtn];
//    [self setNeedsLayout];
}


-(void)layoutSubviews
{
    [self.mainView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(self.mas_centerX);
        make.centerY.mas_equalTo(self.mas_centerY);
        make.width.mas_equalTo(280.f);
        make.height.mas_equalTo(self.mainViewHeight);
    }];
    
    [self.titleView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.mainView.mas_left);
        make.right.mas_equalTo(self.mainView.mas_right);
        make.top.mas_equalTo(self.mainView.mas_top);
        make.height.mas_equalTo(50);
    }];
    
    [self.titleLabel mas_makeConstraints:^(MASConstraintMaker *make)
    {
        make.top.mas_equalTo(self.titleView.mas_top);
        make.left.mas_equalTo(self.titleView.mas_left);
        make.right.mas_equalTo(self.titleView.mas_right);
        make.bottom.mas_equalTo(self.titleView.mas_bottom);
    }];
    
    [self.lineHTitle mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.mainView.mas_left).mas_offset(20);
        make.right.mas_equalTo(self.mainView.mas_right).mas_offset(-20);
        make.top.mas_equalTo(self.titleView.mas_bottom);
        make.height.mas_equalTo(1);
    }];

    [self.detailView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(self.mainView.mas_left);
            make.right.mas_equalTo(self.mainView.mas_right);
            make.top.mas_equalTo(self.self.lineHTitle.mas_bottom);
            make.height.mas_equalTo(self.mainViewHeight-101);
        }];
    
    [self.detailLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.detailView.mas_left).mas_offset(10);
        make.right.mas_equalTo(self.detailView.mas_right).mas_offset(-10);
        make.top.mas_equalTo(self.detailView.mas_top).mas_offset(10);
        make.bottom.mas_equalTo(self.detailView.mas_bottom).mas_offset(-10);
    }];

    [self.lineHDetail mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.left.mas_equalTo(self.mainView.mas_left).mas_offset(20);
        make.right.mas_equalTo(self.mainView.mas_right).mas_offset(-20);
        make.top.mas_equalTo(self.detailView.mas_bottom);
        make.height.mas_equalTo(1);
    }];
    
    [self.operationView mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.left.mas_equalTo(self.mainView.mas_left);
        make.right.mas_equalTo(self.mainView.mas_right);
        make.top.mas_equalTo(self.lineHDetail.mas_bottom);
        make.height.mas_equalTo(50.0f);
    }];
    
    [self.cancelBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        if (self.doneTitle!=nil || self.doneTitle.length!=0) {
            make.left.mas_equalTo(self.operationView.mas_left);
            make.top.mas_equalTo(self.operationView.mas_top);
            make.bottom.mas_equalTo(self.operationView.mas_bottom);
            make.right.mas_equalTo(self.lineVBtn.mas_left);
        }
        else
        {
            make.left.mas_equalTo(self.operationView.mas_left);
            make.top.mas_equalTo(self.operationView.mas_top);
            make.bottom.mas_equalTo(self.operationView.mas_bottom);
            make.right.mas_equalTo(self.operationView.mas_right);
        }
    }];
    
    [self.lineVBtn mas_makeConstraints:^(MASConstraintMaker *make)
    {
        if ((self.cancelTitle!=nil || self.cancelTitle.length!=0) && (self.doneTitle!=nil || self.doneTitle.length!=0)) {
            make.centerX.mas_equalTo(self.operationView.mas_centerX);
            make.top.mas_equalTo(self.operationView.mas_top).offset(5.0f);
            make.bottom.mas_equalTo(self.operationView.mas_bottom).offset(-5.0f);
            make.width.mas_equalTo(1.0f);
        }
    }];
    
    [self.doneBtn mas_makeConstraints:^(MASConstraintMaker *make)
     {
        if (self.cancelTitle.length!=0 || self.cancelTitle!=nil) {
            make.right.mas_equalTo(self.operationView.mas_right);
            make.top.mas_equalTo(self.operationView.mas_top);
            make.bottom.mas_equalTo(self.operationView.mas_bottom);
            make.left.mas_equalTo(self.lineVBtn.mas_right);
        }
        else
        {
            make.right.mas_equalTo(self.operationView.mas_right);
            make.top.mas_equalTo(self.operationView.mas_top);
            make.bottom.mas_equalTo(self.operationView.mas_bottom);
            make.left.mas_equalTo(self.operationView.mas_left);
        }
    }];
}


-(void)setDetailMessage:(NSString *)detailMessage
{
    _detailMessage=detailMessage;
    CGSize size=[self getLabelSizeOfTextSizeToFit:_detailMessage font:[UIFont systemFontOfSize:16.0f]];
    if (size.height>80)
    {
        self.mainViewHeight=size.height+122;
    }
    else
    {
        self.mainViewHeight=202;
    }
}
-(void)setTitleColor:(UIColor *)titleColor
{
    self.titleLabel.textColor=titleColor;
}
-(void)setDetailColor:(UIColor *)detailColor
{
    self.detailLabel.textColor=detailColor;
}
-(void)setCancelTitleColor:(UIColor *)cancelTitleColor
{
    [self.cancelBtn setTitleColor:cancelTitleColor forState:UIControlStateNormal];
}
-(void)setDonetTitleColor:(UIColor *)donetTitleColor
{
    [self.doneBtn setTitleColor:donetTitleColor forState:UIControlStateNormal];
}
-(void)setCornerRadius:(CGFloat)cornerRadius
{
    self.mainView.layer.cornerRadius=cornerRadius;
}
-(void)setViewBackgroundColor:(UIColor *)viewBackgroundColor
{
    self.backgroundColor=viewBackgroundColor;
}

-(void)alertViewShow
{
    UIView *view=(UIView *)[[UIApplication sharedApplication].delegate.window viewWithTag:123456789];
    [view removeFromSuperview];
    [[[[UIApplication sharedApplication] delegate] window] addSubview:self];
}

-(void)alertViewDismiss
{
    [self removeFromSuperview];
}

-(CGSize)getLabelSizeOfTextSizeToFit:(NSString *)message font:(UIFont *)font
{
    if (message) {
        CGSize size = CGSizeZero;
        CGSize rSize=CGSizeMake([UIScreen mainScreen].bounds.size.width-120, MAXFLOAT);
#if __IPHONE_OS_VERSION_MIN_REQUIRED >= __IPHONE_7_0
        NSDictionary* attributes = [NSDictionary dictionaryWithObjectsAndKeys:font, NSFontAttributeName, nil];
        CGRect rect = [message boundingRectWithSize:rSize options:NSStringDrawingUsesLineFragmentOrigin attributes:attributes context:nil];
        size = rect.size;
#else
        size = [message sizeWithFont:font constrainedToSize:rSize lineBreakMode:NSLineBreakByWordWrapping];
#endif
        return size;
    }
    return CGSizeZero;

}

-(void)cancelBtnClick
{
    if(self.CancelClickHandle)
    {
        self.CancelClickHandle(self);
    }
    if (self.delegate && [self.delegate respondsToSelector:@selector(AlertViewCancelButtonSelected:)]) {
        [self.delegate performSelector:@selector(AlertViewCancelButtonSelected:) withObject:self];
    }
    [self alertViewDismiss];
}

-(void)doneBtnClick
{
    if(self.DoneClickHandle)
    {
        self.DoneClickHandle(self);
    }
    if (self.delegate && [self.delegate respondsToSelector:@selector(AlertViewDoneButtonSelected:)]) {
        [self.delegate performSelector:@selector(AlertViewDoneButtonSelected:) withObject:self];
    }
    [self alertViewDismiss];
}



@end
