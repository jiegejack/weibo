//
//  ObuSDK.h
//  ObuSDK
//
//  Created by Timo Huang on 15/5/8.
//  Copyright (c) 2015年 GENVICT. All rights reserved.
//

#import <Foundation/Foundation.h>
#import "JYBlueObu.h"


@protocol GVObuActionDelegate <NSObject>

/* 发现设备回调 */
-(void)didDiscoverBlueObu:(JYBlueObu *)obu desc:(NSString *)szDesz;

//OBU连接成功后回调
-(void)didDeviceConnected;

//OBU断开连接后回调
-(void)didDeviceDisConnected;

//设备连接失败后回调
-(void)didDeviceConnectFailed;

@end

/* 定义回调函数 */
typedef void(^obuCallBack)(Boolean status,NSObject * data,NSString *errorMsg);

@interface ObuSDK : NSObject

/* ObuSDK单例 */
+(ObuSDK *)sharedObuSDK;

/* 检测蓝牙开启 */
-(Boolean)isEnabledBluetooth;

/* 检查OBU连接 */
-(Boolean)checkConnection:(obuCallBack)callBack;

/*获取所有搜索到的设备*/
-(void)searchDevice:(int)timeout callBack:(obuCallBack)callBack;

/* 设置监测OBU状态代理 */
-(void)setObuActionDelegate:(id)obj;

/* 开始搜索 */
/* 调用开始搜索按钮，将一直搜索，发现的设备将在didDiscoverBlueObu:desc代理方法中回调。
 */
-(void)startScan:(obuCallBack)callBack;

/* 结束搜索蓝牙设备 */
- (void)stopScan;

/* 连接OBU设备 */
-(void)connectDevice:(int)timeout callBack:(obuCallBack)callBack;

/*根据id绑定然后连接设备*/
-(void)connectDeviceWithId:(NSString *)uuid name:(NSString *)name timeout:(int)timeout callBack:(obuCallBack)callBack;

/*根据设备名称连接设备*/
-(void)connectDeviceWithName:(NSString *)name timeout:(int)timeout callBack:(obuCallBack)callBack;

/* 断开OBU设备 */
-(void)disconnectDevice:(obuCallBack)callBack;

/* 读取卡信息 */
-(void)getCardInformation:(obuCallBack)callBack;

/* 读设备电量 */
-(void)checkBattery:(obuCallBack)callBack;

/* 检查版本信息 */
-(void) getVersion:(obuCallBack)callBack;

/* 读设备信息 */
-(void)getObuInformation:(obuCallBack)callBack;

/* 圈存初始化 */
-(void)loadCreditGetMac1:(NSString *)credit cardId:(NSString *)cardId  terminalNo:(NSString *)terminalNo pinCode:(NSString *)pinCode procType:(NSString *)procType keyIndex:(NSString *)keyIndex callBack:(obuCallBack)callBack;

/* 圈存写卡 */
-(void)loadCreditWriteCard:(NSString *)dateMAC2 callBack:(obuCallBack)callBack;

/* 读终端交易记录文件 */
-(void)readCardTransactionRecord:(NSString *)pinCode maxNumber:(NSInteger)maxNumber callBack:(obuCallBack)callBack;

/* 读联网收费复合消费过程文件 */
-(void)readCardConsumeRecord:(NSInteger)maxNumber callBack:(obuCallBack)callBack;

/* 读取持卡人信息 */
-(void)readCardOwnerRecord:(obuCallBack)callBack;

/* 数据透传 */
/* 透传接口使用说明：
 根据协议，reqData第一个字节已包含cmdCode，所以在该接口中，cmdCode不需要传入指令类型，接口保留cmdCode是为了兼容其他版本的接口，
 用户在使用时，根据协议组装好DATA域（Type+Content），传入reqData即可。
 */
- (void)transCommand:(unsigned char)cmdCode reqData:(NSData *)reqData callBack:(obuCallBack)callBack;

/* 设备绑定 */
- (void)bindOBU:(NSString *)uuid callBack:(obuCallBack)callBack;

/* 设备解绑 */
- (void)unbindOBU:(obuCallBack)callBack;

/*IC卡的cos指令通道*/
-(void)iccChannel:(NSString *)cosData callback:(obuCallBack)callBack;

/*ESAM卡的cos指令通道*/
- (void)esamChannel:(NSString *)cosData callback:(obuCallBack)callBack;

/*设备对系统的认证*/
-(void)intAuthDev:(NSString *)sourceStr mac:(NSString *)mac callback:(obuCallBack)callBack;

//-(void)pressTestWithCount:(int)count callback:(obuCallBack )callBack;

/*替换密钥*/
- (void)writeKey:(NSString *)key callback:(obuCallBack)callBack;

/*非密钥激活*/
- (void)initiateOBU:(obuCallBack)callBack;

@end
