//
//  JSBaseWebViewController.m
//  JSBankCCYRemastered
//
//  Created by Jack on 2019/4/12.
//  Copyright © 2019 Jack. All rights reserved.
//

#import "JSBaseWebViewController.h"

@interface JSBaseWebViewController ()
@property (nonatomic,retain) UILabel *errorLabel;
@property (nonatomic,assign) BOOL shouldObserve;

@end

@implementation JSBaseWebViewController

- (void)setHiddenNaviBar:(BOOL)hiddenNaviBar {
    _hiddenNaviBar = hiddenNaviBar;
    
    self.navigationBar.alpha = !hiddenNaviBar;

    [self.bankWebView mas_remakeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(self.view.mas_left);
        make.right.mas_equalTo(self.view.mas_right);
        make.bottom.mas_equalTo(self.view.mas_bottom);
        make.top.mas_equalTo(self.view.mas_top).offset(hiddenNaviBar ? -STATUSBAR_HEIGHT : self.navigationBarHeight);
    }];
    
}

- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.view.backgroundColor = [UIColor whiteColor];
    self.navigationBar.separatorColor = [UIColor whiteColor];
    self.navigationBar.backgroundColor = [UIColor whiteColor];
    
//    if (self.shouldBarItem) {
//    }
}

#pragma mark - webView返回按钮
- (void)backBarButtonPressed {}

- (void)viewWillLayoutSubviews {
    [super viewWillLayoutSubviews];
    
    self.bankWebView.backgroundColor = [UIColor whiteColor];
}

//- (void)setRequestUrl:(NSString *)requestUrl {
//    _requestUrl = requestUrl;
//
//    [self doWebRequest];
//}

- (void)doWebRequest {
    NSURL *url =[NSURL URLWithString:[self handleRequestUrl]];
    NSURLRequest *request = [[NSURLRequest alloc] initWithURL:url cachePolicy:NSURLRequestReloadIgnoringLocalCacheData timeoutInterval:30.0f];
    [self.bankWebView loadRequest:request];
}

- (NSString *)handleRequestUrl {
    NSString *requestUrl = ([self.requestUrl hasPrefix:@"http://"] || [self.requestUrl hasPrefix:@"https://"]) ? self.requestUrl : [PCDUtil getServerURL:self.requestUrl];

    return requestUrl;
}

- (UIWebView *)bankWebView {
    if (!_bankWebView) {
        for (UIView *subView in [self.view subviews]) {
            if ([subView isKindOfClass:[UIWebView class]]) {
                _bankWebView = (UIWebView *)subView;
            }
        }
    }
    return _bankWebView;
}

- (NSString *)evalJs:(NSString *)strJs {
    strJs=[strJs stringByReplacingOccurrencesOfString:@"\n" withString:@""];
    NSString *result = [self.bankWebView stringByEvaluatingJavaScriptFromString:strJs];
    
    return result;
}

@end
