//
//  GetClientInfoH5Plugin.m
//  PCDBank
//
//  Created by 王俣 on 2018/9/8.
//  Copyright © 2018年 yt. All rights reserved.
//

#import "GetClientInfoH5Plugin.h"

@implementation GetClientInfoH5Plugin

- (void)handler:(id)data andContext:(PCDContext *)context ResponseCallback:(WVJBResponseCallback )responseCallback{
    NSDictionary *dictData = (NSDictionary *)data;
    if (!dictData.notNull) {return;}
    
    NSString *strCallback = dictData[@"callback"];
    BOOL isNew = [dictData[@"isNew"] boolValue];

    NSString *appVersion = [PCDUtil appVersion];
    appVersion = appVersion.notNull ? appVersion : @"";
    
    NSString *uniqueIdentifier = [PCDevice uniqueIdentifier];
    uniqueIdentifier = uniqueIdentifier.notNull ? uniqueIdentifier : @"";

    NSDictionary *dict = @{@"CLIENT_VER_NO" : appVersion,
                           @"CLIENT_OS"     : @"I",
                           @"device_imei"   : uniqueIdentifier
                           };
    NSString *callbackString = [NSString stringWithFormat:@"version_code:%@|login_channel:I|device_imei:%@",appVersion,uniqueIdentifier];
    NSString *dataString = isNew ? [dict JSONRepresentation] : callbackString;
    evaluateJavaScriptOnMainThread_quotes(self, strCallback, dataString);
}

@end
