//
//  CCYVersionAlertView.m
//  AlertTest
//
//  Created by 黄徐根 on 17/6/13.
//  Copyright © 2017年 youki. All rights reserved.
//

#import "CCYVersionAlertView.h"

#define S_Width [UIScreen mainScreen].bounds.size.width

#define S_Height [UIScreen mainScreen].bounds.size.height

@interface CCYVersionAlertView()
{
    CGSize _containSize;
}

@property(nonatomic,strong)UILabel *versionCodeLabel;

@property(nonatomic,strong)UIImageView *backgroundView;

@property(nonatomic,strong)UIScrollView *scrollerView;

@property(nonatomic,strong)UILabel *versionDetailsLabel;

@property(nonatomic,strong)UILabel *titleLabel;

@property(nonatomic,strong)UIView *containtView;

@property(nonatomic,strong)UIButton *doneButton;

@property(nonatomic,strong)UIButton *cancelButton;

@property(nonatomic,copy)NSString *doneTitle;

@property(nonatomic,copy)NSString *cancelTitle;

@property(nonatomic,copy)void(^doneHandle)(void);

@property(nonatomic,copy)void(^cancelHandle)(void);

//具体的版本更新内容信息
@property(nonatomic,copy)NSString *versionDetails;

//更新版本
@property(nonatomic,copy)NSString *versionCode;


@end

@implementation CCYVersionAlertView


+(void)showVersionAlertView:(NSString *)versionCode versionDetails:(NSString *)versionDetails doneTitle:(NSString *)doneTitle cancelTitle:(NSString *)cancelTitle doneHandle:(void(^)(void))doneHandle cancelHandle:(void(^)(void))cancelHandle
{
    
        CCYVersionAlertView *alertView=[[CCYVersionAlertView alloc]init];
        alertView.versionDetails=versionDetails;
        alertView.versionCode=versionCode;
        alertView.doneTitle=doneTitle;
        alertView.cancelTitle=cancelTitle;
        alertView.doneHandle=doneHandle;
        alertView.cancelHandle=cancelHandle;
        [alertView setUp];
        [alertView show];
}


-(id)initVersionAlertView:(NSString *)versionCode versionDetails:(NSString *)versionDetails doneTitle:(NSString *)doneTitle cancelTitle:(NSString *)cancelTitle doneHandle:(void(^)(void))doneHandle cancelHandle:(void(^)(void))cancelHandle
{
    if (self=[super init]) {
        
        self.versionDetails=versionDetails;
        self.versionCode=versionCode;
        self.doneTitle=doneTitle;
        self.cancelTitle=cancelTitle;
        self.doneHandle=doneHandle;
        self.cancelHandle=cancelHandle;
        [self setUp];
    }
    return self;

}

-(UIView *)containtView
{
    if (!_containtView)
    {
        _containtView=[[UIView alloc]initWithFrame:CGRectMake(0, 0, S_Width-80.0f, S_Width-90.0f)];
        _containtView.center=self.center;
        _containtView.layer.cornerRadius=5;
        _containtView.backgroundColor=[UIColor whiteColor];
    }
    return _containtView;
}

-(UIImageView *)backgroundView
{
    if (!_backgroundView)
    {
        _backgroundView=[[UIImageView alloc]initWithFrame:CGRectMake(0, 0, CGRectGetWidth(self.containtView.frame), 195.0/576.0*CGRectGetWidth(self.containtView.frame))];
        _backgroundView.contentMode = UIViewContentModeScaleAspectFit;
      _backgroundView.center=CGPointMake(CGRectGetMidX(self.containtView.frame), CGRectGetMinY(self.containtView.frame));
        _backgroundView.image=[UIImage imageNamed:@"headerImage"];
    }
    return  _backgroundView;
}

-(UILabel *)versionCodeLabel
{
    if (!_versionCodeLabel)
    {
        _versionCodeLabel=[[UILabel alloc]initWithFrame:CGRectMake(0, CGRectGetHeight(self.backgroundView.frame)/2.0+5, CGRectGetWidth(self.containtView.frame), 20)];
        _versionCodeLabel.text=self.versionCode;
        _versionCodeLabel.font=[UIFont systemFontOfSize:14];
        _versionCodeLabel.textAlignment=NSTextAlignmentCenter;
        _versionCodeLabel.textColor=Color().Black;
    }
    return _versionCodeLabel;
}

-(UILabel *)versionDetailsLabel
{
    if (!_versionDetailsLabel)
    {
        _versionDetailsLabel=[[UILabel alloc]initWithFrame:CGRectMake(35, 0, CGRectGetWidth(self.scrollerView.frame)-70,MAXFLOAT)];
        _versionDetailsLabel.backgroundColor=[UIColor whiteColor];
        _versionDetailsLabel.numberOfLines=0;
        _versionDetailsLabel.text=self.versionDetails;
        [self.versionDetailsLabel changeLineSpaceWithSpace:5.0f font:UIFont(16.0f) foreColor:[UIColor blackColor]];

    }
    return _versionDetailsLabel;
}

-(UIButton *)doneButton
{
    if (!_doneButton)
    {
        _doneButton=[UIButton buttonWithType:UIButtonTypeSystem];
        [_doneButton setTitle:self.doneTitle forState:UIControlStateNormal];
        [_doneButton setTitleColor:Color().White forState:UIControlStateNormal];
//        _doneButton.layer.cornerRadius=5;
//        _doneButton.layer.borderWidth=0.5;
//        _doneButton.layer.masksToBounds = YES;
        _doneButton.layer.cornerRadius = 20;
        _doneButton.backgroundColor = Color().MainBlue;
        _doneButton.titleLabel.font=[UIFont systemFontOfSize:15.0f];
//        _doneButton.layer.borderColor=RGBA(74, 139, 234, 1).CGColor;
        [_doneButton addTarget:self action:@selector(done) forControlEvents:UIControlEventTouchUpInside];
    }
    return _doneButton;
}
-(UIButton *)cancelButton
{
    if (!_cancelButton) {
        _cancelButton=[UIButton buttonWithType:UIButtonTypeSystem];
        [_cancelButton setTitle:self.cancelTitle forState:UIControlStateNormal];
        [_cancelButton setTitleColor:Color().White forState:UIControlStateNormal];
        _cancelButton.backgroundColor=Color().MainBlue;
//        _cancelButton.layer.cornerRadius=5;
//        _cancelButton.layer.borderWidth=0.5;
        _cancelButton.layer.cornerRadius = 20;
        _cancelButton.titleLabel.font=[UIFont systemFontOfSize:15.0f];
//        _cancelButton.layer.borderColor=RGBA(153, 153, 153, 1).CGColor;
        [_cancelButton addTarget:self action:@selector(cancel) forControlEvents:UIControlEventTouchUpInside];
    }
    return _cancelButton;
}

-(void)done
{
    if (self.doneHandle)
    {
        self.doneHandle();
    }
    [self removeFromSuperview];
}

-(void)cancel
{
    if (self.cancelHandle){
        self.cancelHandle();
    }
    [self removeFromSuperview];
}



-(UIScrollView *)scrollerView
{
    if (!_scrollerView)
    {
        _scrollerView=[[UIScrollView alloc]initWithFrame:CGRectMake(0, CGRectGetMaxY(self.versionCodeLabel.frame)+10, CGRectGetWidth(self.containtView.frame), CGRectGetHeight(self.containtView.frame)-CGRectGetHeight(self.backgroundView.frame)/2.0-100)];
        _scrollerView.bounces=NO;
        _scrollerView.showsVerticalScrollIndicator=NO;
        _scrollerView.contentSize=CGSizeMake(CGRectGetWidth(self.containtView.frame),CGRectGetHeight(self.versionDetailsLabel.frame) +5);
    }
    return _scrollerView;
}


-(void)setUp
{
    self.frame=[UIScreen mainScreen].bounds;
    
    self.backgroundColor=[[UIColor blackColor] colorWithAlphaComponent:0.6];
    
    if (![self isDescendantOfView:self.containtView])
    {
        [self addSubview:self.containtView];
    }
    if (![self isDescendantOfView:self.backgroundView])
    {
        [self addSubview:self.backgroundView];
    }
    if (![self.containtView isDescendantOfView:self.versionCodeLabel])
    {
        [self.containtView addSubview:self.versionCodeLabel];
    }
    if (![self.containtView isDescendantOfView:self.scrollerView])
    {
        [self.containtView addSubview:self.scrollerView];
    }
    if (![self.scrollerView isDescendantOfView:self.versionDetailsLabel])
    {
        [self.scrollerView addSubview:self.versionDetailsLabel];
    }
    if (![self.containtView isDescendantOfView:self.cancelButton])
    {
        [self.containtView addSubview:self.cancelButton];
        self.cancelButton.frame=self.cancelTitle?CGRectMake(10, CGRectGetMaxY(self.scrollerView.frame)+10, (CGRectGetWidth(self.containtView.frame)-30)/2.0, 40):CGRectZero;
    }
    if (![self.containtView isDescendantOfView:self.doneButton])
    {
        [self.containtView addSubview:self.doneButton];
        self.doneButton.frame=self.cancelTitle?CGRectMake(20+(CGRectGetWidth(self.containtView.frame)-30)/2.0, CGRectGetMaxY(self.scrollerView.frame)+10, (CGRectGetWidth(self.containtView.frame)-30)/2.0, 40):CGRectMake(10, CGRectGetMaxY(self.scrollerView.frame)+10, CGRectGetWidth(self.containtView.frame)-20, 40);
    }
}

-(void)show
{
    [[[[UIApplication sharedApplication] delegate]window] addSubview:self];
}


@end
