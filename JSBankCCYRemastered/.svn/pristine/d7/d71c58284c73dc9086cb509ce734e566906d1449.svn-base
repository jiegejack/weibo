//
//  WebPage.m
//  JSBankCCYRemastered
//
//  Created by Jack on 2019/5/28.
//  Copyright © 2019 Jack. All rights reserved.
//

#import "WebPage.h"
#import "ThirdPartViewController.h"

@interface WebPage ()
@end
@implementation WebPage

- (void)handler:(id)data andContext:(PCDContext *)context ResponseCallback:(WVJBResponseCallback )responseCallback {
    NSDictionary *dict = (NSDictionary *)data;
    if (!dict.notNull) {return;}
    NSString *title = [dict objectForKey:@"title"];
    NSString *url = [dict objectForKey:@"url"];
    NSString *local = [dict objectForKey:@"local"]; //local: 0(三方)；1（非三方）
    local = [NSString stringWithFormat:@"%@",local];
    BOOL isThirdPart = local.notNull ? !local.boolValue : NO;
    url = url.notNull ? url : @"";

    [self goWebViewWithUrl:url isThirdPart:isThirdPart title:title];
}

- (void)goWebViewWithUrl:(NSString *)url isThirdPart:(BOOL)isThirdPart title:(NSString *)title {
    if (!url.notNull) {
        return;
    }
    if (![url hasPrefix:@"https://"] && ![url hasPrefix:@"http://"]) {
        url = [PCDUtil js_getPublicServerURL:url];
    }

    UIWindow *window = [UIApplication sharedApplication].delegate.window;
    UINavigationController *navi = (UINavigationController *)window.rootViewController;

    NSDictionary *param = @{@"url" : url};
    NSDictionary *expando = [PCDUtil IsIphoneX]?@{@"NSLayoutAttributeTop":@"88"}:@{@"NSLayoutAttributeTop":@"64"};
    JSBaseWebViewController *webVC = [PCDWServiceGet() createPCDViewController:param viewControllerClass:[JSBaseWebViewController class] contentViewClass:nil withExpando:expando];
    webVC.navigationTitle = title;
    webVC.requestUrl = url;
    webVC.isThirdPartPage = isThirdPart;
    [navi pushViewController:webVC animated:YES];
}

@end
