//
//  OCRrecognitionPlugin.m
//  JSBankCCYRemastered
//
//  Created by Jack on 2019/5/9.
//  Copyright Â© 2019 Jack. All rights reserved.
//

#import "OCRrecognitionPlugin.h"
#if TARGET_IPHONE_SIMULATOR
#else
#import "JSFaceRecordViewController.h"
#endif

@interface OCRrecognitionPlugin ()

@end

@implementation OCRrecognitionPlugin

- (void)handler:(id)data andContext:(PCDContext *)context ResponseCallback:(WVJBResponseCallback )responseCallback {
#if TARGET_IPHONE_SIMULATOR
#else
    JSBaseWebViewController *viewController = (JSBaseWebViewController *)context.eventTargetList.firstObject;
    NSString *jsonString = (NSString *)data;
    if (!jsonString.notNull) {return;}
    NSDictionary *dict = [jsonString JSONValue];
    NSString *callback =[dict objectForKey:@"callback"];
    
    JSFaceRecordViewController *faceDetect=[[JSFaceRecordViewController alloc]init];
    faceDetect.type = [dict objectForKey:@"type"];
    faceDetect.callBackHandle =^(NSDictionary *dictData) {
        [viewController evalJs:[NSString stringWithFormat:@"%@('%@')",callback,[self replacingStringWithDict:dictData]]];
    };
    [viewController.tabBarController.navigationController pushViewController:faceDetect animated:YES];
#endif
}

- (NSString *)replacingStringWithDict:(NSDictionary *)dict {
    NSString *jsonStr = [NSString stringWithFormat:@"%@",[dict JSONRepresentation]];
    jsonStr           = [jsonStr stringByReplacingOccurrencesOfString:@"\n" withString:@""];
    
    return [jsonStr stringByReplacingOccurrencesOfString:@" " withString:@""];
}

@end
