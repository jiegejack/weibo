//
//  OBUDeviceInfo.m
//  JSBankCCYRemastered
//
//  Created by Jack on 2019/7/24.
//  Copyright © 2019 Jack. All rights reserved.
//
#if TARGET_IPHONE_SIMULATOR
#else

#import "OBUDeviceInfo.h"
#import "OBUManager.h"

@implementation OBUDeviceInfo

- (void)handler:(id)data andContext:(PCDContext *)context ResponseCallback:(WVJBResponseCallback )responseCallback {
    NSDictionary *dict = (NSDictionary *)data;
    NSString *callback = [dict objectForKey:@"callback"];
    callback = callback.notNull ? callback : @"";
    

    __block OBUManager *device = [OBUManager shareInstance];
    [device getBluetoothStatus:^(Boolean status, NSDictionary *dict, NSString *msg) {
        if (status) {
            [device getObuCardOwnerInfo:^(Boolean status, NSDictionary *dict, NSString *msg) {
                NSDictionary *dictionary;
                NSString *name = [dict objectForKey:@"ownerName"];
                if ([name isContainString:@"\0"]) {
                    name = [name stringByReplacingOccurrencesOfString:@"\0" withString:@""];
                    NSMutableDictionary *mDict = dict.mutableCopy;
                    [mDict setObject:name forKey:@"ownerName"];
                    dictionary = mDict;
                } else {
                    dictionary = dict;
                }
                evaluateJavaScriptOnMainThread_quotes(self, callback, [dictionary JSONRepresentation]);
            }];
        } else {
            NSDictionary *dict = @{@"STATUS" : @"1", @"MSG" : @"蓝牙未连接"};
            evaluateJavaScriptOnMainThread_quotes(self, callback, [dict JSONRepresentation]);
        }
    }];
}

@end
#endif
