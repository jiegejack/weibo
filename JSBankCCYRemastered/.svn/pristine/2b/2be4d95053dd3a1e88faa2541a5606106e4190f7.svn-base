//
//  PCDFileDownloadTask.h
//  PCKit
//
//  Created by wangyong on 16/5/11.
//  Copyright © 2016年 P&C Information. All rights reserved.
//

#import <UIKit/UIKit.h>
#import <Foundation/Foundation.h>
#import "NSString+Additions.h"

#define dispatch_main_async_safe(block)\
if ([NSThread isMainThread]) {\
block();\
} else {\
dispatch_async(dispatch_get_main_queue(), block);\
}

/**
 *  @brief 文件下载
 */
@interface PCDFileDownloadTask : NSObject

/**
 *  @brief 下载路径
 */
@property(nullable,nonatomic,copy) NSString *URLString;

/**
 *  @brief 缓存路径
 */
@property(nullable,nonatomic,copy) NSString *cachePath;

/**
 *  @brief 文件缓存全路径
 */
@property(nullable,nonatomic,copy,readonly) NSString *cacheFilePath;

/**
 始终信任证书
 */
@property(nonatomic,assign) BOOL allwaysCertificates;

/**
 *  @brief 快速初始化
 *
 *  @param URLString 下载路径
 *  @param cachePath 缓存路径
 *
 *  @return 实例化
 */
-(nonnull id)initWithURLString:(nullable NSString *)URLString cachePath:(nullable NSString *)cachePath;

/**
 *  @brief 缓存文件
 *
 *  @return 缓存文件流
 */
-(nullable NSData *)cacheFile;

/**
 *  @brief 下载并回调
 *
 *  @param callback 下载回调
 */
-(void)downloadCallback:(void(^ _Nullable)(NSData *_Nullable fileData,NSString *_Nullable fileMD5,NSError *_Nullable error))callback;

/**
 根据键值从内存中取对象

 @param key 键值
 @return 对象
 */
+(nullable id)cacheObjectForKey:(nullable NSString *)key;

/**
 将对象保存在内存中

 @param object 对象
 @param key 键值
 */
+(void)setCacheObject:(nullable id)object forKey:(nullable NSString *)key;

/**
清空内存
 */
+(void)clearCacheFile;

@end
